<h1>Publisher Subscription Test Page</h1>

<label for="publisher_topics">Topic</label>
<input id="publisher_topics" type="text" value="topic1,topic2">
<input type="submit" value="Register Publisher" onclick="registerPublisher()">
<br>
<label for="publisher_id">Publisher Id</label>
<input id="publisher_id" type="text" value="">
<label for="message">Message</label>
<input id="message" type="text" value="message1">
<input type="submit" value="Publish" onclick="publish()">
<br>
<label for="topics">Topics</label>
<input id="topics" type="text" value="topic1,topic2">
<input type="submit" value="subscribe" onclick="subscribe()">
<br>
<label for="subscription">Subscription Id</label>
<input id="subscription" type="text" value="">
<input type="submit" value="pull" onclick="pull()">

<script type="text/javascript">
    function registerPublisher() {
        var xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4) {
                alert(xhr.response);
            }
        }
        var topics = document.getElementById('publisher_topics').value.split(/\s*,\s*/);
        xhr.open('post', '/registerPublisher', true);
        xhr.setRequestHeader('Content-Type', 'application/json');
        xhr.send(JSON.stringify(topics));
    }
    function publish() {
        var xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4) {
                alert(xhr.response);
            }
        }
        var publisher_id = document.getElementById('publisher_id').value;
        var message = document.getElementById('message').value;
        xhr.open('post', '/'+publisher_id+'/publish', true);
        xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded; charset=UTF-8');
        xhr.send(message);
    }
    function subscribe() {
        var xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4) {
                alert(xhr.response);
            }
        }
        var topics = document.getElementById('topics').value.split(/\s*,\s*/);
        xhr.open('post', '/subscribe', true);
        xhr.setRequestHeader('Content-Type', 'application/json');
        xhr.send(JSON.stringify(topics));
    }
    function pull() {
        var xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4) {
                alert(xhr.response);
            }
        }
        var subscription_id = document.getElementById('subscription').value;
        xhr.open('get', '/'+subscription_id+'/pull', true);
        xhr.send();
    }
</script>